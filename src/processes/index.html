<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Processes - scmRTOS</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Processes";
        var mkdocs_page_input_path = "src/processes.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> scmRTOS
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Intro</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Not a Preface</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RTOS Components</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/">Kernel</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Processes</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#general-information-and-internal-representation">General Information and Internal Representation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-process-concept">The Process Concept</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tbaseprocess">TBaseProcess</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#stack">Stack</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#timeouts">Timeouts</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#priorities">Priorities</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-sleep-function">The sleep() Function</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-and-using-a-process">Creating and Using a Process</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#defining-a-process-type">Defining a Process Type</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#declaring-a-process-object-and-using-it">Declaring a Process Object and Using It</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#alternative-ways-to-declare-a-process-object">Alternative Ways to Declare a Process Object</a>
        <ul>
    <li class="toctree-l5"><a class="reference internal" href="#external-function">External Function</a>
    </li>
    <li class="toctree-l5"><a class="reference internal" href="#executable-function-as-a-process-constructor-argument">Executable Function as a Process Constructor Argument</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#starting-a-process-in-a-suspended-state">Starting a Process in a Suspended State</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#process-restart">Process Restart</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#terminate-process-execution">Terminate Process Execution</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#start-process-execution">Start Process Execution</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ipcs/">Interprocess Communications</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ports/">Ports</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../debug/">Debug</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../profiler/">Process Profiling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example-job-queue/">Example: Job Queue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../glossary/">Glossary</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">scmRTOS</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">RTOS Components</li>
      <li class="breadcrumb-item active">Processes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="processes">Processes<a class="headerlink" href="#processes" title="Permanent link">ðŸ”—</a></h1>
<hr />
<h2 id="general-information-and-internal-representation">General Information and<br> Internal Representation<a class="headerlink" href="#general-information-and-internal-representation" title="Permanent link">ðŸ”—</a></h2>
<h3 id="the-process-concept">The Process Concept<a class="headerlink" href="#the-process-concept" title="Permanent link">ðŸ”—</a></h3>
<p>In <strong>scmRTOS</strong>, a process is an object of a type derived from the class <code>OS::TBaseProcess</code>. The reason each process requires its own distinct typeâ€”rather than simply creating all processes as objects of <code>OS::TBaseProcess</code>â€”is that, despite their similarities, processes differ in key aspects: they have different stack sizes and different priority values (which, it should be remembered, are assigned statically).</p>
<p>To define process types, the standard C++ featureâ€”templatesâ€”is used. This approach yields compact process types that contain all necessary internal data, including the process stack itself, which varies in size across processes and is specified individually.</p>
<h3 id="tbaseprocess">TBaseProcess<a class="headerlink" href="#tbaseprocess" title="Permanent link">ðŸ”—</a></h3>
<p>The core functionality of a process is defined in the base class <code>OS::TBaseProcess</code>, from which actual processes are derived using the <code>OS::process&lt;&gt;</code> template, as mentioned earlier. This approach is chosen to avoid duplicating identical code across template instantiations<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<p>Therefore, the template itself declares only those elements that differ between processes&nbsp;â€“ the stacks and the process executable function (<code>exec()</code>). The source code for the class <code>OS::TBaseProcess</code> is presented<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>, see "Listing 1. TBaseProcess".</p>
<figure>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="mo">01</span><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">TBaseProcess</span><span class="w">                                                             </span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="mo">02</span><span class="w">    </span><span class="p">{</span><span class="w">                                                                              </span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="mo">03</span><span class="w">        </span><span class="k">friend</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TKernel</span><span class="p">;</span><span class="w">                                                      </span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="mo">04</span><span class="w">        </span><span class="k">friend</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TISRW</span><span class="p">;</span><span class="w">                                                        </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="mo">05</span><span class="w">        </span><span class="k">friend</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TISRW_SS</span><span class="p">;</span><span class="w">                                                     </span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="mo">06</span><span class="w">        </span><span class="k">friend</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TKernelAgent</span><span class="p">;</span><span class="w">                                                 </span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="mo">07</span><span class="w">                                                                                   </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="mi">08</span><span class="w">        </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">run</span><span class="p">();</span><span class="w">                                                         </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="mi">09</span><span class="w">                                                                                   </span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="mi">10</span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">                                                                        </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="mi">11</span><span class="w">        </span><span class="n">TBaseProcess</span><span class="p">(</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">StackPoolEnd</span><span class="w">                                  </span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="mi">12</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">TPriority</span><span class="w"> </span><span class="n">pr</span><span class="w">                                                 </span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="mi">13</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exec</span><span class="p">)()</span><span class="w">                                               </span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="mi">14</span><span class="w">                </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                      </span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="mi">15</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aStackPool</span><span class="w">                                    </span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="mi">16</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w">   </span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                                      </span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="mi">17</span><span class="w">                </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                             </span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="mi">18</span><span class="w">                    </span><span class="p">);</span><span class="w">                                                             </span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="mi">19</span><span class="w">    </span><span class="k">protected</span><span class="o">:</span><span class="w">                                                                     </span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="mi">20</span><span class="w">        </span><span class="n">INLINE</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">set_unready</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Kernel</span><span class="p">.</span><span class="n">set_process_unready</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Priority</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="mi">21</span><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">init_stack_frame</span><span class="p">(</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">StackPoolEnd</span><span class="w">                         </span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="mi">22</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exec</span><span class="p">)()</span><span class="w">                                      </span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="mi">23</span><span class="w">        </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                              </span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="mi">24</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">StackPool</span><span class="w">                            </span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="mi">25</span><span class="w">        </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                     </span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="mi">26</span><span class="w">                             </span><span class="p">);</span><span class="w">                                                    </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="mi">27</span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">                                                                        </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="mi">28</span><span class="w">                                                                                   </span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="mi">29</span><span class="w">    </span><span class="err">#</span><span class="k">else</span><span class="w">  </span><span class="c1">// SEPARATE_RETURN_STACK                                                </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="mi">30</span><span class="w">                                                                                   </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="mi">31</span><span class="w">        </span><span class="n">TBaseProcess</span><span class="p">(</span><span class="w"> </span><span class="n">stack_item_t</span><span class="o">*</span><span class="w"> </span><span class="n">StackPoolEnd</span><span class="w">                                   </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="mi">32</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="o">*</span><span class="w"> </span><span class="n">RStack</span><span class="w">                                         </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="mi">33</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">TPriority</span><span class="w"> </span><span class="n">pr</span><span class="w">                                                 </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="mi">34</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exec</span><span class="p">)()</span><span class="w">                                               </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="mi">35</span><span class="w">                </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                      </span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="mi">36</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aStackPool</span><span class="w">                                    </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="mi">37</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aRStackPool</span><span class="w">                                   </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="mi">38</span><span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w">   </span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                                      </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="mi">39</span><span class="w">                </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                             </span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="mi">40</span><span class="w">                    </span><span class="p">);</span><span class="w">                                                             </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="mi">41</span><span class="w">    </span><span class="k">protected</span><span class="o">:</span><span class="w">                                                                     </span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="mi">42</span><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">init_stack_frame</span><span class="p">(</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Stack</span><span class="w">                                </span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="mi">43</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">RStack</span><span class="w">                               </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="mi">44</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">exec</span><span class="p">)()</span><span class="w">                                      </span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="mi">45</span><span class="w">        </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                              </span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="mi">46</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">StackPool</span><span class="w">                            </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="mi">47</span><span class="w">                             </span><span class="p">,</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">RStackPool</span><span class="w">                           </span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="mi">48</span><span class="w">        </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                     </span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="mi">49</span><span class="w">                             </span><span class="p">);</span><span class="w">                                                    </span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="mi">50</span><span class="w">                                                                                   </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="mi">51</span><span class="w">        </span><span class="n">TPriority</span><span class="w">   </span><span class="n">priority</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Priority</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">                          </span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="mi">52</span><span class="w">                                                                                   </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="mi">53</span><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">sleep</span><span class="p">(</span><span class="n">timeout_t</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">                                  </span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="mi">54</span><span class="w">               </span><span class="kt">void</span><span class="w"> </span><span class="n">wake_up</span><span class="p">();</span><span class="w">                                                     </span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="mi">55</span><span class="w">               </span><span class="kt">void</span><span class="w"> </span><span class="n">force_wake_up</span><span class="p">();</span><span class="w">                                               </span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="mi">56</span><span class="w">        </span><span class="n">INLINE</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">force_wake_up</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w">                                   </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="mi">57</span><span class="w">                                                                                   </span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="mi">58</span><span class="w">        </span><span class="n">INLINE</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_sleeping</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">                                           </span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="mi">59</span><span class="w">        </span><span class="n">INLINE</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_suspended</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">                                          </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="mi">60</span><span class="w">                                                                                   </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="mi">61</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                                  </span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="mi">62</span><span class="w">      </span><span class="n">INLINE</span><span class="w"> </span><span class="n">TService</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">waiting_for</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">WaitingFor</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">                 </span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="mi">63</span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">                                                                        </span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="mi">64</span><span class="w">               </span><span class="kt">size_t</span><span class="w">       </span><span class="n">stack_size</span><span class="p">()</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">StackSize</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">              </span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="mi">65</span><span class="w">               </span><span class="kt">size_t</span><span class="w">       </span><span class="n">stack_slack</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">                                   </span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="mi">66</span><span class="w">               </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">                   </span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="mi">67</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w"> </span><span class="c1">// scmRTOS_DEBUG_ENABLE                                                 </span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="mi">68</span><span class="w">                                                                                   </span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="mi">69</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_PROCESS_RESTART_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                        </span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="mi">70</span><span class="w">    </span><span class="k">protected</span><span class="o">:</span><span class="w">                                                                     </span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="mi">71</span><span class="w">               </span><span class="kt">void</span><span class="w"> </span><span class="n">reset_controls</span><span class="p">();</span><span class="w">                                              </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="mi">72</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                         </span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="mi">73</span><span class="w">                                                                                   </span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="mi">74</span><span class="w">        </span><span class="c1">//-----------------------------------------------------                    </span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="mi">75</span><span class="w">        </span><span class="c1">//                                                                         </span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="mi">76</span><span class="w">        </span><span class="c1">//    Data members                                                         </span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="mi">77</span><span class="w">        </span><span class="c1">//                                                                         </span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="mi">78</span><span class="w">    </span><span class="k">protected</span><span class="o">:</span><span class="w">                                                                     </span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="mi">79</span><span class="w">        </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w">     </span><span class="n">StackPointer</span><span class="p">;</span><span class="w">                                           </span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="mi">80</span><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="n">timeout_t</span><span class="w"> </span><span class="n">Timeout</span><span class="p">;</span><span class="w">                                                </span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="mi">81</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">TPriority</span><span class="w">    </span><span class="n">Priority</span><span class="p">;</span><span class="w">                                               </span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="mi">82</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                                  </span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="mi">83</span><span class="w">        </span><span class="n">TService</span><span class="w">           </span><span class="o">*</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="n">WaitingFor</span><span class="p">;</span><span class="w">                                  </span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="mi">84</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">stack_item_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w">    </span><span class="n">StackPool</span><span class="p">;</span><span class="w">                                   </span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="mi">85</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w">                  </span><span class="n">StackSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// as number of stack_item_t items</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="mi">86</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w">                  </span><span class="o">*</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w">                                        </span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="mi">87</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w"> </span><span class="c1">// scmRTOS_DEBUG_ENABLE                                                 </span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="mi">88</span><span class="w">                                                                                   </span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="mi">89</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_PROCESS_RESTART_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                        </span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="mi">90</span><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="n">TProcessMap</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">WaitingProcessMap</span><span class="p">;</span><span class="w">                                  </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="mi">91</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                         </span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="mi">92</span><span class="w">                                                                                   </span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="mi">93</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_SUSPENDED_PROCESS_ENABLE</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">                                      </span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="mi">94</span><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">TProcessMap</span><span class="w"> </span><span class="n">SuspendedProcessMap</span><span class="p">;</span><span class="w">                                    </span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="mi">95</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                         </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="mi">96</span><span class="w">    </span><span class="p">};</span><span class="w">                                                                             </span>
</span></code></pre></div>
<figcaption>
<p>Listing 1. TBaseProcess  </p>
</figcaption>
</figure>
<p>Despite the seemingly extensive class definition, <code>TBaseProcess</code> is actually quite small and simple. Its data representation consists of just three core members: the stack pointer (line 79), the timeout tick counter (line 80), and the priority value (line 81). The remaining data members are auxiliary and appear only when additional features are enabled&nbsp;â€“ such as the ability to interrupt and restart a process at any point, or debugging support<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>.</p>
<p>The class interface provides the following functions:</p>
<ul>
<li><code>sleep(timeout_t timeout = 0)</code>. Puts the process into a sleeping state: the argument value is assigned to the internal timeout counter, the process is removed from the ready-to-run process map, and the scheduler is invoked to transfer control to the next ready process.</li>
<li><code>wake_up()</code>. Wakes the process from sleep. The process is marked ready only if it was waiting for an event with a timeout; if its priority is higher than the current process, it immediately receives control.</li>
<li><code>force_wake_up()</code>. Forces the process out of sleep. The process is always marked ready. If its priority is higher than the current process, it immediately receives control. This function should be used with extreme caution, as incorrect usage can lead to unpredictable program behavior.</li>
<li><code>is_sleeping()</code>. Checks whether the process is sleeping (i.e., waiting for an event with a timeout).</li>
<li><code>is_suspended()</code>. Checks whether the process is in a suspended (inactive) state.</li>
</ul>
<p><a name="process-stack"></a></p>
<h3 id="stack">Stack<a class="headerlink" href="#stack" title="Permanent link">ðŸ”—</a></h3>
<p>A process stack is a contiguous region of RAM used to store process data, save the process context, and hold return addresses from functions and interrupts.</p>
<p>Due to architectural features of some processors, two separate stacks may be used&nbsp;â€“ one for data and one for return addresses. <strong>scmRTOS</strong> supports this capability, allowing each process object to contain two distinct RAM regions (two stacks), with sizes specified individually based on application requirements. Support for separate stacks is enabled via the <code>SEPARATE_RETURN_STACK</code> macro defined in <code>os_target.h</code>.</p>
<p>Within a protected section, a critically important function <code>init_stack_frame()</code> is declared, responsible for constructing the initial stack frame. The reason is that process executable functions do not start like ordinary functions&nbsp;â€“ they are not called in the traditional way. Control reaches them through the same mechanism used for context switches between processes. Therefore, starting a process involves restoring its context from the stack followed by a jump to the address stored as the saved interrupt return point.</p>
<p>To enable this startup method, the process stack must be prepared accordingly: specific memory cells in the stack are initialized with required values, making the stack appear as if the process had previously been preempted (with its context properly saved). The exact steps for preparing the stack frame are platform-specific, so the implementation of <code>init_stack_frame()</code> is delegated to the OS port layer.</p>
<h3 id="timeouts">Timeouts<a class="headerlink" href="#timeouts" title="Permanent link">ðŸ”—</a></h3>
<p>Each process has a dedicated <code>Timeout</code> variable to control its behavior during event waits with timeouts or during sleep. Essentially, this variable acts as a down-counter of system timer ticks. When its value is non-zero, it is decremented in the system timer interrupt handler and tested against zero. Upon reaching zero, the owning process is marked ready to run.</p>
<p>Thus, if a process is put to sleep with a timeout (i.e., removed from the ready map via <code>sleep(timeout)</code> with a non-zero argument), it will be automatically awakened<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup> in the system timer interrupt handler after an interval corresponding to the specified number of system ticks<sup id="fnref:5"><a class="footnote-ref" href="#fn:5">5</a></sup>.</p>
<p>The same mechanism applies when a service function is called that involves waiting for an event with a timeout. The process will be awakened either when the expected event occurs or when the timeout expires. The value returned by the service function unambiguously indicates the reason for awakening, allowing the user program to easily decide on subsequent actions.</p>
<h3 id="priorities">Priorities<a class="headerlink" href="#priorities" title="Permanent link">ðŸ”—</a></h3>
<p>Each process also has a data field holding its priority. This field serves as the process identifier when manipulating processes and their internal representation&nbsp;â€“ in particular, the priority is used as an index into the kernel's process pointer table, where the address of each process is stored upon registration.</p>
<p>Priorities are unique&nbsp;â€“ no two processes may share the same priority. The internal representation is an integer variable. For type safety when assigning priorities, a dedicated enumerated type <code>TPriority</code> is used.</p>
<p><a name="process-sleep"></a></p>
<h3 id="the-sleep-function">The sleep() Function<a class="headerlink" href="#the-sleep-function" title="Permanent link">ðŸ”—</a></h3>
<p>This function is used to transition the current process from an active state to an inactive one. If the function is called with an argument of 0 (or without specifying an argument&nbsp;â€“ the function has a default argument of 0), the process will enter sleep indefinitely until it is explicitly awakened, for example, by another process using <code>TBaseProcess::force_wake_up()</code>. If called with a non-zero argument, the process will sleep for the specified number of system timer ticks, after which it will be automatically awakened (i.e., marked ready-to-run). In this case, the sleep can also be interrupted prematurely by another process or an interrupt handler using <code>TBaseProcess::wake_up()</code> or <code>TBaseProcess::force_wake_up()</code>.</p>
<hr />
<h2 id="creating-and-using-a-process">Creating and Using a Process<a class="headerlink" href="#creating-and-using-a-process" title="Permanent link">ðŸ”—</a></h2>
<h3 id="defining-a-process-type">Defining a Process Type<a class="headerlink" href="#defining-a-process-type" title="Permanent link">ðŸ”—</a></h3>
<p>To create a process, its type must be defined and an object of that type declared.</p>
<p>A concrete process type is described using the <code>OS::process</code> template, see "Listing 2. Process Template".</p>
<figure>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="mo">01</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="n">TPriority</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">stk_size</span><span class="p">,</span><span class="w"> </span><span class="n">TProcessStartState</span><span class="w"> </span><span class="n">pss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pssRunning</span><span class="o">&gt;</span><span class="w">     </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="mo">02</span><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">process</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TBaseProcess</span><span class="w">                                              </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="mo">03</span><span class="w">    </span><span class="p">{</span><span class="w">                                                                                </span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="mo">04</span><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w">                                                                          </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="mo">05</span><span class="w">        </span><span class="n">INLINE_PROCESS_CTOR</span><span class="w"> </span><span class="n">process</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">name_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="mo">06</span><span class="w">                                                                                     </span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="mo">07</span><span class="w">        </span><span class="n">OS_PROCESS</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">exec</span><span class="p">();</span><span class="w">                                               </span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="mi">08</span><span class="w">                                                                                     </span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="mi">09</span><span class="w">    </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_PROCESS_RESTART_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                                          </span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="mi">10</span><span class="w">        </span><span class="n">INLINE</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">terminate</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w">                                 </span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="mi">11</span><span class="w">    </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                                           </span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="mi">12</span><span class="w">                                                                                     </span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="mi">13</span><span class="w">    </span><span class="k">private</span><span class="o">:</span><span class="w">                                                                         </span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="mi">14</span><span class="w">        </span><span class="n">stack_item_t</span><span class="w"> </span><span class="n">Stack</span><span class="p">[</span><span class="n">stk_size</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">stack_item_t</span><span class="p">)];</span><span class="w">                           </span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="mi">15</span><span class="w">    </span><span class="p">};</span><span class="w">                                                                               </span>
</span></code></pre></div>
<figcaption>
<p>Listing 2. Process Template  </p>
</figcaption>
</figure>
<p>As shown, two elements are added to what the base class provides:</p>
<ul>
<li>The process stack <code>Stack</code> with size <code>stack_size</code>. The size is specified in bytes.</li>
<li>The static function <code>exec()</code>, which is the actual function containing the user code for the process.</li>
</ul>
<h3 id="declaring-a-process-object-and-using-it">Declaring a Process Object and Using It<a class="headerlink" href="#declaring-a-process-object-and-using-it" title="Permanent link">ðŸ”—</a></h3>
<p>It is now sufficient to declare an object of this typeâ€”which becomes the process itselfâ€”and to define the process function <code>exec()</code>.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">typedef</span><span class="w"> </span><span class="n">OS</span><span class="o">::</span><span class="n">process</span><span class="o">&lt;</span><span class="n">OS</span><span class="o">::</span><span class="n">prN</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Slon</span><span class="p">;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">Slon</span><span class="w"> </span><span class="n">slon</span><span class="p">;</span>
</span></code></pre></div>
<p>where <code>N</code> is the priority number.</p>
<p><a href="../overview/#process-exec">"Listing 1. Process Executable Function in Overview section"</a> illustrates a typical example of a process function.</p>
<p>Using a process primarily involves writing user code inside the process function. As previously mentioned, a few simple rules must be followed:</p>
<ul>
<li>Care must be taken to ensure that program flow never exits the process function. Otherwise, since this function was not called in the conventional way, upon exit the flow of control would jump to undefined addresses, leading to undefined program behavior (though in practice, the behavior is usually quite defined&nbsp;â€“ the program simply stops working!).</li>
<li>The function <code>TBaseProcess::wake_up()</code> should be used cautiously and thoughtfully, while <code>TBaseProcess::force_wake_up()</code> requires particular care, as careless use can cause premature awakening of a sleeping (delayed) process, potentially leading to collisions in interprocess interaction.</li>
</ul>
<p><a name="process-alternate-exec"></a></p>
<h4 id="alternative-ways-to-declare-a-process-object">Alternative Ways to Declare a Process Object<a class="headerlink" href="#alternative-ways-to-declare-a-process-object" title="Permanent link">ðŸ”—</a></h4>
<h5 id="external-function">External Function<a class="headerlink" href="#external-function" title="Permanent link">ðŸ”—</a></h5>
<p>When declaring a process object, a pointer to an external function of type <code>void func()</code> can be passed to the constructor; in this case, that function will serve as the process executable function, see "Listing 3. Using an external function as the executable".</p>
<figure>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="mo">01</span><span class="w">    </span><span class="n">OS_PROCESS</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">slon_exec</span><span class="p">();</span><span class="w">          </span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="mo">02</span><span class="w">                                          </span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="mo">03</span><span class="w">    </span><span class="n">Slon</span><span class="w"> </span><span class="n">slon</span><span class="p">(</span><span class="s">&quot;Slon Process&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">slon_exec</span><span class="p">);</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="mo">04</span><span class="w">                                          </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="mo">05</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">slon_exec</span><span class="p">()</span><span class="w">                      </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="mo">06</span><span class="w">    </span><span class="p">{</span><span class="w">                                     </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="mo">07</span><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="c1">// Declarations               </span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="mi">08</span><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="c1">// Init processâ€™s data        </span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="mi">09</span><span class="w">        </span><span class="k">for</span><span class="p">(;;)</span><span class="w">                           </span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="mi">10</span><span class="w">        </span><span class="p">{</span><span class="w">                                 </span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="mi">11</span><span class="w">            </span><span class="p">...</span><span class="w"> </span><span class="c1">// processâ€™s main loop    </span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="mi">12</span><span class="w">        </span><span class="p">}</span><span class="w">                                 </span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="mi">13</span><span class="w">    </span><span class="p">}</span><span class="w">                                     </span>
</span></code></pre></div>
<figcaption>
<p>Listing 3. Using an external function as the executable</p>
</figcaption>
</figure>
<p>The advantage of this approach is a more concise notation without the need to specify full template specialization (<code>template&lt;&gt;</code>) and the namespace <code>OS</code>, which are required when using the member function <code>process::exec()</code>.</p>
<h5 id="executable-function-as-a-process-constructor-argument">Executable Function as a Process Constructor Argument<a class="headerlink" href="#executable-function-as-a-process-constructor-argument" title="Permanent link">ðŸ”—</a></h5>
<p>In addition to a regular function, an anonymous function with the required signature can be passed to the process&nbsp;â€“ this is implemented in C++ using lambda functions, see "Listing 4. Lambda Function as Process Executable Function".</p>
<figure>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="mo">01</span><span class="w">    </span><span class="n">Slon</span><span class="w"> </span><span class="n">slon</span><span class="p">(</span><span class="s">&quot;Slon Process&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="w">      </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="mo">02</span><span class="w">    </span><span class="p">{</span><span class="w">                                 </span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="mo">03</span><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="c1">// Declarations           </span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="mo">04</span><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="c1">// Init processâ€™s data    </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="mo">05</span><span class="w">        </span><span class="k">for</span><span class="p">(;;)</span><span class="w">                       </span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="mo">06</span><span class="w">        </span><span class="p">{</span><span class="w">                             </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="mo">07</span><span class="w">            </span><span class="p">...</span><span class="w"> </span><span class="c1">// processâ€™s main loop</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="mi">08</span><span class="w">        </span><span class="p">}</span><span class="w">                             </span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="mi">09</span><span class="w">    </span><span class="p">});</span><span class="w">                               </span>
</span></code></pre></div>
<figcaption>
<p>Listing 4. Lambda Function as Process Executable Function</p>
</figcaption>
</figure>
<p>The main advantage of this method is its conciseness: the process object and its executable function are contained in a single expression.</p>
<div class="admonition warning">
<p class="admonition-title"><strong>NOTE</strong></p>
<p>Referring to "Listing 2. Process Template" (line 5), it can be seen that when an external function is used as the executable, the process name must also be specified&nbsp;â€“ this is a requirement of C++ language syntax (default argument rules).</p>
<p>In practice, the process name is used only for debugging purposes, so it is not mandatory, and the question may arise about additional overhead when the name is not needed. However, the process constructor implementation is such that no overhead occurs, see "Listing 5. Process Constructor".</p>
<p>From the listing, it is evident that the process name is used only when debugging is enabled (line 04); otherwise, the <code>const char *</code> argument becomes unnamed and is removed from the code, so no overhead is introduced.</p>
</div>
<figure>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="mo">01</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="n">TPriority</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">stk_size</span><span class="p">,</span><span class="w"> </span><span class="n">TProcessStartState</span><span class="w"> </span><span class="n">pss</span><span class="o">&gt;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="mo">02</span><span class="w">    </span><span class="n">OS</span><span class="o">::</span><span class="n">process</span><span class="o">&lt;</span><span class="n">pr</span><span class="p">,</span><span class="w"> </span><span class="n">stk_size</span><span class="p">,</span><span class="w"> </span><span class="n">pss</span><span class="o">&gt;::</span><span class="n">process</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w">          </span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="mo">03</span><span class="w">        </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                              </span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="mo">04</span><span class="w">        </span><span class="n">name_str</span><span class="w">                                                   </span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="mo">05</span><span class="w">        </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                     </span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="mo">06</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)()</span><span class="w">                                           </span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="mo">07</span><span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TBaseProcess</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Stack</span><span class="p">[</span><span class="n">stk_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">stack_item_t</span><span class="p">)]</span><span class="w">   </span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="mi">08</span><span class="w">                         </span><span class="p">,</span><span class="w"> </span><span class="n">pr</span><span class="w">                                      </span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="mi">09</span><span class="w">                         </span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">exec</span><span class="w">                      </span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="mi">10</span><span class="w">                      </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_DEBUG_ENABLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">                </span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="mi">11</span><span class="w">                         </span><span class="p">,</span><span class="w"> </span><span class="n">Stack</span><span class="w">                                   </span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="mi">12</span><span class="w">                         </span><span class="p">,</span><span class="w"> </span><span class="n">name_str</span><span class="w">                                </span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="mi">13</span><span class="w">                      </span><span class="err">#</span><span class="n">endif</span><span class="w">                                       </span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="mi">14</span><span class="w">                         </span><span class="p">)</span><span class="w">                                         </span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="mi">15</span><span class="w">                                                                   </span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="mi">16</span><span class="w">    </span><span class="p">{</span><span class="w">                                                              </span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="mi">17</span><span class="w">        </span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="n">scmRTOS_SUSPENDED_PROCESS_ENABLE</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">                  </span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="mi">18</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pss</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pssSuspended</span><span class="w"> </span><span class="p">)</span><span class="w">                                 </span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="mi">19</span><span class="w">            </span><span class="n">clr_prio_tag</span><span class="p">(</span><span class="n">SuspendedProcessMap</span><span class="p">,</span><span class="w"> </span><span class="n">get_prio_tag</span><span class="p">(</span><span class="n">pr</span><span class="p">));</span><span class="w">   </span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="mi">20</span><span class="w">        </span><span class="err">#</span><span class="n">endif</span><span class="w">                                                     </span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="mi">21</span><span class="w">    </span><span class="p">}</span><span class="w">                                                              </span>
</span></code></pre></div>
<figcaption>
<p>Listing 5. Process Constructor</p>
</figcaption>
</figure>
<h3 id="starting-a-process-in-a-suspended-state">Starting a Process in a Suspended State<a class="headerlink" href="#starting-a-process-in-a-suspended-state" title="Permanent link">ðŸ”—</a></h3>
<p>Sometimes it is necessary for a process's executable function to begin execution not immediately after system startup, but only upon receiving a specific signal. For example, several processes should start working only after some equipment (possibly external to the MCU) has been initialized/configured; otherwise, incorrect actions toward that equipment could have undesirable consequences.</p>
<p>In such cases, some form of dispatching is required&nbsp;â€“ the processes must organize their operation in a way that preserves the correct interaction logic with the equipment. For instance, all processes except one (the dispatcher) could immediately wait at startup for a start event that will be signaled by the dispatcher process.</p>
<p>The dispatcher process performs all necessary preparatory work and then signals the start to the waiting processes. This approach requires manually adding appropriate waiting code to each process awaiting startup, which clutters the code, increases workload, and is error-prone.</p>
<p>There may also be other situations requiring delayed process activation. To support this functionality, a process can be configured to start in a so-called <strong>suspended</strong> state. Such a process is identical to any other except that its tag is absent from the ready-to-run process map (<code>ReadyProcessMap</code>).</p>
<p>Declaration of such a process looks like this<sup id="fnref:6"><a class="footnote-ref" href="#fn:6">6</a></sup>:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">typedef</span><span class="w"> </span><span class="n">OS</span><span class="o">::</span><span class="n">process</span><span class="o">&lt;</span><span class="n">OS</span><span class="o">::</span><span class="n">pr1</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="n">OS</span><span class="o">::</span><span class="n">pssSuspended</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Proc2</span><span class="p">;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">...</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">Proc2</span><span class="w"> </span><span class="n">proc2</span><span class="p">;</span>
</span></code></pre></div>
<p>Later, to start this process, the initiating code must call the <code>force_wake_up()</code> function:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">Proc2</span><span class="p">.</span><span class="n">force_wake_up</span><span class="p">();</span>
</span></code></pre></div>
<hr />
<p><a name="process-restart"></a></p>
<h2 id="process-restart">Process Restart<a class="headerlink" href="#process-restart" title="Permanent link">ðŸ”—</a></h2>
<p>Situations may arise where it is necessary to externally interrupt a process and restart it from the beginning. For example, a process performs lengthy computations, but at some point the results become obsolete, and a new computation cycle with fresh data must be started. This can be achieved by terminating the current execution with the ability to restart the process from scratch.</p>
<p>To support this, the OS provides two functions to the user:</p>
<ul>
<li><code>OS::process::terminate(void (*func)() = 0)</code>;</li>
<li><code>OS::TBaseProcess::start()</code>.</li>
</ul>
<h4 id="terminate-process-execution">Terminate Process Execution<a class="headerlink" href="#terminate-process-execution" title="Permanent link">ðŸ”—</a></h4>
<p>The <code>terminate()</code> function is intended to be called from outside the process being stopped. Inside it, all resources associated with the process are reset to their initial state, and the process is marked as not ready to run. If the process was waiting on a service, its tag is removed from that service's waiting process map.</p>
<p>The <code>terminate()</code> function can accept a pointer to a function as an argument; this function will serve as the executable entry point for the process on the next start. This provides considerable flexibility in program implementation&nbsp;â€“ on each restart, the exact executable function required in the current program context can be specified.</p>
<div class="admonition tip">
<p class="admonition-title"><strong>TIP</strong></p>
<p>The ability to specify the executable function on restart can be effectively used to simulate process deletion and creation&nbsp;â€“ some libraries are designed to require dynamic resource allocation for their operation, in particular the creation of processes to perform tasks followed by their deletion.</p>
<p><strong>scmRTOS</strong> does not support dynamic process creation and deletion for reasons <a href="../overview/#avoid-dynamic-process">described earlier</a>, but creation/deletion can be simulated, for example by organizing a pool of processes from which an available process can be taken when needed and assigned an appropriate executable function.</p>
<p>Changing process priorities or stack sizes is not possibleâ€”these parameters are set statically during OS configurationâ€”but in many cases this is not required, since the resources needed to perform tasks are usually known at build time.</p>
</div>
<h4 id="start-process-execution">Start Process Execution<a class="headerlink" href="#start-process-execution" title="Permanent link">ðŸ”—</a></h4>
<p>Starting the process is performed separately&nbsp;â€“ allowing the user to do so at the moment they deem appropriate&nbsp;â€“ using the <code>start()</code> function, which simply marks the process as ready-to-run. The process will resume execution according to its priority and the current OS load.</p>
<p>For process termination and restart to work correctly, this feature must be enabled during configurationâ€”the macro <code>scmRTOS_PROCESS_RESTART_ENABLE</code> must be set to 1.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>In programming slang, these are often called instances.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>In reality, there are two variants of this class: the standard one (shown here) and a version with a separate return-address stack. The latter is omitted for brevity, as it introduces no fundamental differences relevant to understanding the concepts.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>This applies to the rest of the code as wellâ€”the majority of the class definition is devoted to these optional capabilities.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>I.e., marked ready-to-run.&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p>More precisely, the interval is accurate to within a fraction of one tick period, depending on the timing of the <code>sleep</code> call relative to the next timer interrupt.&#160;<a class="footnote-backref" href="#fnref:5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:6">
<p>The <code>ss</code> prefix in this example stands for <strong>Start State</strong>.&#160;<a class="footnote-backref" href="#fnref:6" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../kernel/" class="btn btn-neutral float-left" title="Kernel"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ipcs/" class="btn btn-neutral float-right" title="Interprocess Communications">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../kernel/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ipcs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../js/mathjax.js"></script>
      <script src="../../js/mathjax/tex-mml-chtml.js"></script>
      <script src="../../js/wavedrom.min.js"></script>
      <script src="../../js/wavedrom_loader.js"></script>
      <script src="../../js/wavedrom.unpkg.js"></script>
      <script src="../../js/wavedrom_skin_default.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body>
</html>
